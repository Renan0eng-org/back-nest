{
	"info": {
		"_postman_id": "notif-push-2025-1234-abcd",
		"name": "Notificações & Web Push",
		"description": "Rotas para sistema de notificações (sino), histórico, leitura/não lidas e Web Push Notifications.",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Push Subscriptions",
			"item": [
				{
					"name": "Subscribe to Push",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{authToken}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"endpoint\": \"https://fcm.googleapis.com/fcm/send/abc123def456...\",\n  \"keys\": {\n    \"p256dh\": \"BK4wgX...base64-encoded-public-key\",\n    \"auth\": \"a1b2c3d4...base64-encoded-auth-secret\"\n  },\n  \"userAgent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0.0.0\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/push/subscribe",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"push",
								"subscribe"
							]
						},
						"description": "Registra uma assinatura de Web Push para o usuário autenticado. Se o endpoint já existir, atualiza para o novo userId."
					},
					"response": [
						{
							"name": "Success",
							"originalRequest": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"endpoint\": \"https://fcm.googleapis.com/fcm/send/abc123\",\n  \"keys\": {\n    \"p256dh\": \"BK4wgX...\",\n    \"auth\": \"a1b2c3...\"\n  }\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/push/subscribe",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"push",
										"subscribe"
									]
								}
							},
							"status": "Created",
							"code": 201,
							"_postman_previewlanguage": "json",
							"header": [],
							"cookie": [],
							"body": "{\n  \"id\": \"8f3b4a5c-1234-5678-90ab-cdef12345678\"\n}"
						}
					]
				},
				{
					"name": "Unsubscribe from Push",
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{authToken}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"endpoint\": \"https://fcm.googleapis.com/fcm/send/abc123def456...\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/push/subscribe",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"push",
								"subscribe"
							]
						},
						"description": "Desabilita (seta disabledAt) uma assinatura de push pelo endpoint."
					},
					"response": [
						{
							"name": "Success",
							"originalRequest": {
								"method": "DELETE",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"endpoint\": \"https://fcm.googleapis.com/fcm/send/abc123\"\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/push/subscribe",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"push",
										"subscribe"
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [],
							"cookie": [],
							"body": "{\n  \"status\": 204\n}"
						}
					]
				}
			],
			"description": "Gerenciamento de assinaturas de Web Push Notifications."
		},
		{
			"name": "Notifications",
			"item": [
				{
					"name": "Create Notification",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{authToken}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"Consulta agendada\",\n  \"body\": \"Você tem uma consulta agendada para amanhã às 10h.\",\n  \"data\": {\n    \"url\": \"/admin/agendamentos/123\",\n    \"appointmentId\": \"appt-456\"\n  },\n  \"category\": \"agendamento\",\n  \"priority\": 1,\n  \"targets\": {\n    \"userIds\": [\"user-123\", \"user-456\"]\n  },\n  \"sendPush\": true\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/notifications",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"notifications"
							]
						},
						"description": "Cria uma notificação para os usuários especificados. Se sendPush=true, envia Web Push imediatamente."
					},
					"response": [
						{
							"name": "Success",
							"originalRequest": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"title\": \"Consulta agendada\",\n  \"body\": \"Amanhã às 10h\",\n  \"targets\": {\n    \"userIds\": [\"user-123\"]\n  },\n  \"sendPush\": true\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/notifications",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"notifications"
									]
								}
							},
							"status": "Created",
							"code": 201,
							"_postman_previewlanguage": "json",
							"header": [],
							"cookie": [],
							"body": "{\n  \"notificationId\": \"notif-789abc\",\n  \"recipients\": 2\n}"
						}
					]
				},
				{
					"name": "List Notifications",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{authToken}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/notifications?status=UNREAD&limit=20",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"notifications"
							],
							"query": [
								{
									"key": "status",
									"value": "UNREAD",
									"description": "UNREAD | READ | ARCHIVED (opcional)"
								},
								{
									"key": "limit",
									"value": "20",
									"description": "Número de itens (default: 20, max: 100)"
								},
								{
									"key": "after",
									"value": "",
									"description": "Cursor base64 para paginação (opcional)",
									"disabled": true
								},
								{
									"key": "category",
									"value": "",
									"description": "Filtrar por categoria (opcional)",
									"disabled": true
								}
							]
						},
						"description": "Lista as notificações do usuário autenticado com paginação cursor-based."
					},
					"response": [
						{
							"name": "Success",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{baseUrl}}/notifications?status=UNREAD&limit=20",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"notifications"
									],
									"query": [
										{
											"key": "status",
											"value": "UNREAD"
										},
										{
											"key": "limit",
											"value": "20"
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [],
							"cookie": [],
							"body": "{\n  \"items\": [\n    {\n      \"id\": \"notif-789\",\n      \"title\": \"Consulta agendada\",\n      \"body\": \"Você tem uma consulta amanhã às 10h.\",\n      \"data\": {\n        \"url\": \"/admin/agendamentos/123\"\n      },\n      \"status\": \"UNREAD\",\n      \"category\": \"agendamento\",\n      \"priority\": 1,\n      \"createdAt\": \"2025-12-19T10:30:00Z\",\n      \"readAt\": null\n    }\n  ],\n  \"nextCursor\": \"eyJjcmVhdGVkQXQiOiIyMDI1LTEyLTE5VDEwOjMwOjAwWiIsImlkIjoibm90aWYtNzg5In0=\"\n}"
						}
					]
				},
				{
					"name": "Get Unread Count",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{authToken}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/notifications/unread-count",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"notifications",
								"unread-count"
							]
						},
						"description": "Retorna a quantidade de notificações não lidas do usuário. Ideal para badge no sino."
					},
					"response": [
						{
							"name": "Success",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{baseUrl}}/notifications/unread-count",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"notifications",
										"unread-count"
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [],
							"cookie": [],
							"body": "{\n  \"count\": 5\n}"
						}
					]
				},
				{
					"name": "Mark as Read",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{authToken}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"read\": true\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/notifications/:id/read",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"notifications",
								":id",
								"read"
							],
							"variable": [
								{
									"key": "id",
									"value": "notif-789abc",
									"description": "ID da notificação"
								}
							]
						},
						"description": "Marca uma notificação como lida (read: true) ou não lida (read: false)."
					},
					"response": [
						{
							"name": "Success",
							"originalRequest": {
								"method": "PATCH",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"read\": true\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/notifications/notif-789/read",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"notifications",
										"notif-789",
										"read"
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [],
							"cookie": [],
							"body": "{\n  \"status\": 204\n}"
						}
					]
				},
				{
					"name": "Mark All as Read",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{authToken}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"category\": \"agendamento\",\n  \"before\": \"2025-12-31T23:59:59Z\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/notifications/read-all",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"notifications",
								"read-all"
							]
						},
						"description": "Marca todas as notificações como lidas. Aceita filtros opcionais: category e before (data ISO)."
					},
					"response": [
						{
							"name": "Success",
							"originalRequest": {
								"method": "PATCH",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{}"
								},
								"url": {
									"raw": "{{baseUrl}}/notifications/read-all",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"notifications",
										"read-all"
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [],
							"cookie": [],
							"body": "{\n  \"status\": 204\n}"
						}
					]
				},
				{
					"name": "Archive Notification",
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{authToken}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/notifications/:id",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"notifications",
								":id"
							],
							"variable": [
								{
									"key": "id",
									"value": "notif-789abc",
									"description": "ID da notificação"
								}
							]
						},
						"description": "Arquiva uma notificação (soft delete - muda status para ARCHIVED)."
					},
					"response": [
						{
							"name": "Success",
							"originalRequest": {
								"method": "DELETE",
								"header": [],
								"url": {
									"raw": "{{baseUrl}}/notifications/notif-789",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"notifications",
										"notif-789"
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [],
							"cookie": [],
							"body": "{\n  \"status\": 204\n}"
						}
					]
				}
			],
			"description": "CRUD completo de notificações: criar, listar, marcar como lida, arquivar."
		},
		{
			"name": "Examples - Use Cases",
			"item": [
				{
					"name": "Create System Notification",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{authToken}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"Manutenção programada\",\n  \"body\": \"O sistema ficará offline amanhã das 2h às 4h para manutenção.\",\n  \"category\": \"sistema\",\n  \"priority\": 0,\n  \"targets\": {\n    \"userIds\": [\"all-users-ids-here\"]\n  },\n  \"sendPush\": true\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/notifications",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"notifications"
							]
						},
						"description": "Exemplo: Notificação de sistema para múltiplos usuários."
					},
					"response": []
				},
				{
					"name": "Create Appointment Reminder",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{authToken}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"Consulta em 1 hora\",\n  \"body\": \"Não se esqueça da consulta às 15h com Dr. Silva.\",\n  \"data\": {\n    \"url\": \"/appointments/789\",\n    \"appointmentId\": \"appt-789\"\n  },\n  \"category\": \"lembrete\",\n  \"priority\": 1,\n  \"targets\": {\n    \"userIds\": [\"patient-123\"]\n  },\n  \"sendPush\": true\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/notifications",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"notifications"
							]
						},
						"description": "Exemplo: Lembrete de consulta com alta prioridade e URL de navegação."
					},
					"response": []
				},
				{
					"name": "Get Only Agendamento Notifications",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{authToken}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/notifications?category=agendamento&status=UNREAD&limit=50",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"notifications"
							],
							"query": [
								{
									"key": "category",
									"value": "agendamento"
								},
								{
									"key": "status",
									"value": "UNREAD"
								},
								{
									"key": "limit",
									"value": "50"
								}
							]
						},
						"description": "Exemplo: Listar apenas notificações não lidas da categoria 'agendamento'."
					},
					"response": []
				}
			],
			"description": "Exemplos práticos de casos de uso comuns."
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:3000",
			"type": "string"
		},
		{
			"key": "authToken",
			"value": "seu-token-jwt-aqui",
			"type": "string"
		}
	]
}
