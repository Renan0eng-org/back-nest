{
	"info": {
		"_postman_id": "forms-api-collection",
		"name": "Forms API - Sistema Prefeitura",
		"description": "Coleção completa para API de Formulários com criação, edição, respostas e atribuições",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{access_token}}",
				"type": "string"
			}
		]
	},
	"variable": [
		{
			"key": "base_url",
			"value": "https://prefeitura.back.renannardi.com",
			"type": "string"
		},
		{
			"key": "access_token",
			"value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6InJlbmFuLm5hcmRpLmRldkBnbWFpbC5jb20iLCJzdWIiOiJyZW5hbl9hZG1pbl8yIiwiaWF0IjoxNzY3OTE5MzA1LCJleHAiOjE3Njg1MjQxMDV9.D4ILXg6K3T0ts-_iWoJ2-_U2Lzv4gylFqUzJff8Xa9s",
			"type": "string"
		},
		{
			"key": "form_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "response_id",
			"value": "",
			"type": "string"
		}
	],
	"item": [
		{
			"name": "Formulários",
			"item": [
				{
					"name": "Criar Formulário",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    var jsonData = pm.response.json();",
									"    pm.collectionVariables.set(\"form_id\", jsonData.id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"Formulário de Triagem\",\n  \"description\": \"Formulário para triagem inicial de pacientes\",\n  \"questions\": [\n    {\n      \"text\": \"Qual é o seu nível de dor?\",\n      \"type\": \"MULTIPLE_CHOICE\",\n      \"required\": true,\n      \"options\": [\n        {\n          \"text\": \"Sem dor\",\n          \"value\": 0\n        },\n        {\n          \"text\": \"Dor leve\",\n          \"value\": 2\n        },\n        {\n          \"text\": \"Dor moderada\",\n          \"value\": 5\n        },\n        {\n          \"text\": \"Dor severa\",\n          \"value\": 10\n        }\n      ]\n    },\n    {\n      \"text\": \"Quais sintomas você apresenta?\",\n      \"type\": \"CHECKBOXES\",\n      \"required\": true,\n      \"options\": [\n        {\n          \"text\": \"Febre\",\n          \"value\": 3\n        },\n        {\n          \"text\": \"Tosse\",\n          \"value\": 2\n        },\n        {\n          \"text\": \"Dor de cabeça\",\n          \"value\": 1\n        },\n        {\n          \"text\": \"Falta de ar\",\n          \"value\": 5\n        }\n      ]\n    },\n    {\n      \"text\": \"Observações adicionais\",\n      \"type\": \"TEXT\",\n      \"required\": false,\n      \"options\": []\n    }\n  ],\n  \"scoreRules\": [\n    {\n      \"minScore\": 0,\n      \"maxScore\": 3,\n      \"classification\": \"Baixo risco\",\n      \"conduct\": \"Orientação e liberação\",\n      \"order\": 1\n    },\n    {\n      \"minScore\": 4,\n      \"maxScore\": 7,\n      \"classification\": \"Risco moderado\",\n      \"conduct\": \"Avaliação médica em até 2 horas\",\n      \"order\": 2\n    },\n    {\n      \"minScore\": 8,\n      \"maxScore\": 100,\n      \"classification\": \"Alto risco\",\n      \"conduct\": \"Atendimento imediato\",\n      \"order\": 3\n    }\n  ]\n}"
						},
						"url": {
							"raw": "{{base_url}}/forms",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"forms"
							]
						},
						"description": "Cria um novo formulário com perguntas e regras de pontuação"
					},
					"response": []
				},
				{
					"name": "Listar Todos os Formulários",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/forms?page=1&pageSize=10",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"forms"
							],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "pageSize",
									"value": "10"
								},
								{
									"key": "title",
									"value": "",
									"disabled": true
								},
								{
									"key": "description",
									"value": "",
									"disabled": true
								},
								{
									"key": "isScreening",
									"value": "true",
									"disabled": true
								},
								{
									"key": "responsesMin",
									"value": "0",
									"disabled": true
								},
								{
									"key": "responsesMax",
									"value": "100",
									"disabled": true
								},
								{
									"key": "createdFrom",
									"value": "2025-01-01",
									"disabled": true
								},
								{
									"key": "createdTo",
									"value": "2025-12-31",
									"disabled": true
								}
							]
						},
						"description": "Lista todos os formulários com filtros opcionais"
					},
					"response": []
				},
				{
					"name": "Buscar Formulário por ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/forms/{{form_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"forms",
								"{{form_id}}"
							]
						},
						"description": "Busca um formulário específico pelo ID"
					},
					"response": []
				},
				{
					"name": "Atualizar Formulário",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"Formulário de Triagem - Atualizado\",\n  \"description\": \"Formulário atualizado para triagem inicial de pacientes\",\n  \"questions\": [\n    {\n      \"text\": \"Qual é o seu nível de dor?\",\n      \"type\": \"MULTIPLE_CHOICE\",\n      \"required\": true,\n      \"options\": [\n        {\n          \"text\": \"Sem dor\",\n          \"value\": 0\n        },\n        {\n          \"text\": \"Dor leve\",\n          \"value\": 2\n        },\n        {\n          \"text\": \"Dor moderada\",\n          \"value\": 5\n        },\n        {\n          \"text\": \"Dor severa\",\n          \"value\": 10\n        }\n      ]\n    }\n  ],\n  \"scoreRules\": [\n    {\n      \"minScore\": 0,\n      \"maxScore\": 5,\n      \"classification\": \"Baixo risco\",\n      \"conduct\": \"Orientação e liberação\",\n      \"order\": 1\n    },\n    {\n      \"minScore\": 6,\n      \"maxScore\": 100,\n      \"classification\": \"Alto risco\",\n      \"conduct\": \"Atendimento prioritário\",\n      \"order\": 2\n    }\n  ]\n}"
						},
						"url": {
							"raw": "{{base_url}}/forms/{{form_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"forms",
								"{{form_id}}"
							]
						},
						"description": "Atualiza um formulário existente"
					},
					"response": []
				},
				{
					"name": "Deletar Formulário",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}/forms/{{form_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"forms",
								"{{form_id}}"
							]
						},
						"description": "Remove um formulário"
					},
					"response": []
				},
				{
					"name": "Listar Formulários de Triagem",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/forms/screenings?page=1&pageSize=10",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"forms",
								"screenings"
							],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "pageSize",
									"value": "10"
								}
							]
						},
						"description": "Lista apenas os formulários marcados como triagem"
					},
					"response": []
				},
				{
					"name": "Meus Formulários",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/forms/user/my",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"forms",
								"user",
								"my"
							]
						},
						"description": "Retorna os formulários atribuídos ao usuário autenticado"
					},
					"response": []
				}
			]
		},
		{
			"name": "Triagem",
			"item": [
				{
					"name": "Ativar como Triagem",
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{base_url}}/forms/{{form_id}}/activate-screening",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"forms",
								"{{form_id}}",
								"activate-screening"
							]
						},
						"description": "Marca o formulário como formulário de triagem ativo"
					},
					"response": []
				},
				{
					"name": "Desativar como Triagem",
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{base_url}}/forms/{{form_id}}/deactivate-screening",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"forms",
								"{{form_id}}",
								"deactivate-screening"
							]
						},
						"description": "Remove a marcação de triagem do formulário"
					},
					"response": []
				},
				{
					"name": "Alternar Triagem",
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{base_url}}/forms/{{form_id}}/toggle-screening",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"forms",
								"{{form_id}}",
								"toggle-screening"
							]
						},
						"description": "Alterna o status de triagem do formulário (ativa/desativa)"
					},
					"response": []
				}
			]
		},
		{
			"name": "Respostas",
			"item": [
				{
					"name": "Enviar Resposta ao Formulário",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    var jsonData = pm.response.json();",
									"    pm.collectionVariables.set(\"response_id\", jsonData.id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"answers\": [\n    {\n      \"questionId\": \"question-id-1\",\n      \"value\": \"Dor moderada\"\n    },\n    {\n      \"questionId\": \"question-id-2\",\n      \"values\": [\"Febre\", \"Tosse\"]\n    },\n    {\n      \"questionId\": \"question-id-3\",\n      \"value\": \"Paciente relata sintomas há 3 dias\"\n    }\n  ],\n  \"attendanceId\": \"attendance-id-opcional\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/forms/{{form_id}}/responses",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"forms",
								"{{form_id}}",
								"responses"
							]
						},
						"description": "Envia uma resposta para um formulário específico. O sistema calculará automaticamente a pontuação."
					},
					"response": []
				},
				{
					"name": "Listar Respostas do Formulário",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/forms/{{form_id}}/responses?page=1&pageSize=10",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"forms",
								"{{form_id}}",
								"responses"
							],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "pageSize",
									"value": "10"
								}
							]
						},
						"description": "Lista todas as respostas de um formulário específico"
					},
					"response": []
				},
				{
					"name": "Buscar Resposta Específica",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/forms/{{form_id}}/responses/{{response_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"forms",
								"{{form_id}}",
								"responses",
								"{{response_id}}"
							]
						},
						"description": "Busca uma resposta específica de um formulário"
					},
					"response": []
				},
				{
					"name": "Atualizar Resposta",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"answers\": [\n    {\n      \"questionId\": \"question-id-1\",\n      \"value\": \"Dor severa\"\n    },\n    {\n      \"questionId\": \"question-id-2\",\n      \"values\": [\"Febre\", \"Tosse\", \"Falta de ar\"]\n    }\n  ]\n}"
						},
						"url": {
							"raw": "{{base_url}}/forms/{{form_id}}/responses/{{response_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"forms",
								"{{form_id}}",
								"responses",
								"{{response_id}}"
							]
						},
						"description": "Atualiza uma resposta existente"
					},
					"response": []
				},
				{
					"name": "Deletar Resposta",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}/forms/{{form_id}}/responses/{{response_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"forms",
								"{{form_id}}",
								"responses",
								"{{response_id}}"
							]
						},
						"description": "Remove uma resposta do formulário"
					},
					"response": []
				},
				{
					"name": "Listar Todas as Respostas (Global)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/forms/responses/list?page=1&pageSize=10",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"forms",
								"responses",
								"list"
							],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "pageSize",
									"value": "10"
								},
								{
									"key": "formTitle",
									"value": "",
									"disabled": true
								},
								{
									"key": "patientName",
									"value": "",
									"disabled": true
								},
								{
									"key": "from",
									"value": "2025-01-01",
									"disabled": true
								},
								{
									"key": "to",
									"value": "2025-12-31",
									"disabled": true
								},
								{
									"key": "isScreening",
									"value": "true",
									"disabled": true
								},
								{
									"key": "scoreMin",
									"value": "0",
									"disabled": true
								},
								{
									"key": "scoreMax",
									"value": "10",
									"disabled": true
								}
							]
						},
						"description": "Lista todas as respostas de todos os formulários com filtros"
					},
					"response": []
				},
				{
					"name": "Detalhes da Resposta",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/forms/response/{{response_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"forms",
								"response",
								"{{response_id}}"
							]
						},
						"description": "Busca detalhes completos de uma resposta específica (sem necessidade de form_id)"
					},
					"response": []
				}
			]
		},
		{
			"name": "Atribuição de Usuários",
			"item": [
				{
					"name": "Listar Usuários para Atribuir",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/forms/users/toAssign?page=1&pageSize=20",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"forms",
								"users",
								"toAssign"
							],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "pageSize",
									"value": "20"
								}
							]
						},
						"description": "Lista usuários disponíveis para serem atribuídos aos formulários"
					},
					"response": []
				},
				{
					"name": "Listar Usuários Atribuídos ao Formulário",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/forms/{{form_id}}/assigned?page=1&pageSize=20",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"forms",
								"{{form_id}}",
								"assigned"
							],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "pageSize",
									"value": "20"
								}
							]
						},
						"description": "Lista todos os usuários atribuídos a um formulário específico"
					},
					"response": []
				},
				{
					"name": "Atribuir Usuários ao Formulário",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"userIds\": [\n    \"user-id-1\",\n    \"user-id-2\",\n    \"user-id-3\"\n  ]\n}"
						},
						"url": {
							"raw": "{{base_url}}/forms/{{form_id}}/assign",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"forms",
								"{{form_id}}",
								"assign"
							]
						},
						"description": "Atribui uma lista de usuários ao formulário"
					},
					"response": []
				},
				{
					"name": "Remover Atribuição de Usuários",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"userIds\": [\n    \"user-id-1\",\n    \"user-id-2\"\n  ]\n}"
						},
						"url": {
							"raw": "{{base_url}}/forms/{{form_id}}/unassign",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"forms",
								"{{form_id}}",
								"unassign"
							]
						},
						"description": "Remove a atribuição de usuários do formulário"
					},
					"response": []
				}
			]
		}
	]
}
